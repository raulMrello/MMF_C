<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>MMF: C:/_workspace/minimal_multithreaded_framework/src/mmf/os/Task.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mmf_logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">MMF
   &#160;<span id="projectnumber">0.1.0 build 2015.03.13</span>
   </div>
   <div id="projectbrief">Minimal Multithreading Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d27009801b8aacb310b7982950a03223.html">src</a></li><li class="navelem"><a class="el" href="dir_18c50efe5cc0bab841777d61e4200daa.html">mmf</a></li><li class="navelem"><a class="el" href="dir_a38fed49489c5eaa64c71d3c0739a511.html">os</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Task.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * task.h</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *  Created on: 11/3/2015</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *      Author: raulMrello</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#ifndef MMF_OS_TASK_TASK_H_</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define MMF_OS_TASK_TASK_H_</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;list&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;cstddef&gt;</span>  </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;../port/generic/Timer.h&quot;</span> </div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#define SECONDS(v)      (v*1000000)     </span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#define MILLIS(v)       (v*1000)        </span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#define MICROS(v)       (v)             </span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#define PRIO_CRITICAL   (int)0          </span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#define PRIO_HIGH       (int)8          </span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#define PRIO_MED        (int)16         </span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#define PRIO_LOW        (int)24         </span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#define SUBPRIO_MAX     (int)0          </span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#define SUBPRIO_MIN     (int)7          </span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#define EVT_NONE        (int)0x00000000 </span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#define EVT_RESUMED     (int)0x00000001 </span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#define EVT_TOPIC       (int)0x00000002 </span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#define EVT_FLAGS       (int)0x00000004 </span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="code" href="class_task.html">   53</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_task.html" title="Tasks are pieces of software capable to be executed in a run-to-completion manner, this implies that they must return to allow other tasks to be executed (they never must block). Tasks can be STOPPED during initialization, WAITING for an event, READY for execution, RUNNING during execution and YIELD if allow other tasks to take control of the cpu.">Task</a> {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="code" href="class_task.html#a73d48a91578f634b3b191e4d63684e72">   56</a></span>&#160;    <span class="keyword">enum</span> <a class="code" href="class_task.html#a73d48a91578f634b3b191e4d63684e72" title="(task status)">Stat</a> {STOPPED, READY, WAITING, RUNNING, YIELD};    </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="code" href="class_task.html#a27a2c8bccb379a632c2a2369cbfa2224">   63</a></span>&#160;    <a class="code" href="class_task.html#a27a2c8bccb379a632c2a2369cbfa2224" title="Default constructor. Task name can be assigned during object creation.">Task</a>(std::string name = <span class="stringliteral">&quot;&quot;</span>) : <a class="code" href="class_task.html#a28ec34b5b8eb76b4a76172f11b93af53" title="Task name.">_name</a>(name){</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        _status = STOPPED;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        _tmr = NULL;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        _evtlist.clear();</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <a class="code" href="class_task.html#a00e8e39305d63fc2e6b65dba7b18e9fe" title="Task priority in the range PRIO_CRITICAL .. PRIO_LOW + SUBPRIO_MIN.">prio</a> = PRIO_LOW + SUBPRIO_MIN;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keyword">virtual</span> <a class="code" href="class_task.html#a3ecf499ea35fb4a96853969a1e1cbbce" title="Default destructor. It will deallocate all resources.">~Task</a>();</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="class_task.html#aa7aeb450a822c8e4b53d2d6654073fcc" title="Interface to initialize inherited classes during task creation.">init</a>()=0;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="class_task.html#ab17886ef8196862de81aef338fd27424" title="Interface to execute task implementation of the inherited classes.">exec</a>(<span class="keywordtype">int</span> evt) = 0;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="class_task.html#ad1591a816cf4ab538ad158a487446c3f" title="Interface to kill inherited classes.">kill</a>()=0;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_task.html#a1d4e4a8a23ecc05e36b7bf7ff078459f" title="Starts task assigning a fixed priority.">start</a>(<span class="keywordtype">int</span> vprio);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_task.html#aba51f0ee66f2f42e361be6cc8639e5fc" title="Suspends a task during several microseconds.">suspend</a>(<span class="keywordtype">int</span> delay_us);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_task.html#a6fbcbc8e4d264bd9230fc794ea898d53" title="Sets a task ready after a period of suspension.">resume</a>();</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_task.html#ac9858ec2b4431b9fe06cecda3b901f0f" title="Sets a task yielded to allow other tasks to take control of the cpu.">yield</a>();</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_task.html#abf94fbac9e645727e9e4b8cc59119baf" title="Checks if it is yielded.">isYield</a>();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_task.html#a52b1948265838893a03c3dc3aec48848" title="Checks if it is ready for execution.">isReady</a>();</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_task.html#ad29f9fd753d6d805f651c1da2189ed9b" title="Sets a task ready, indicating which event has caused it.">setReady</a>(<span class="keywordtype">int</span> evt=0);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_task.html#a47d3d52ab68ae011176985dea5503d31" title="Sets a task waiting for some situation.">setWaiting</a>();</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_task.html#a81ed7148858ae6af41d3b3e8dc88112e" title="Sets a task running.">setRunning</a>();</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_task.html#ac9ac1f22bc2ca7552103d066db28ac4b" title="Sets a task stopped.">setStop</a>();</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="class_task.html#a1deaaa0d4e56202e5122f9acb4a49b90" title="Get the next event which causes the task to be executed.">getNextEvt</a>();</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="code" href="class_task.html#a00e8e39305d63fc2e6b65dba7b18e9fe">  152</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="class_task.html#a00e8e39305d63fc2e6b65dba7b18e9fe" title="Task priority in the range PRIO_CRITICAL .. PRIO_LOW + SUBPRIO_MIN.">prio</a>;       </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="class_task.html#a73d48a91578f634b3b191e4d63684e72" title="(task status)">Stat</a> _status;               </div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="classmcu_1_1_timer.html">mcu::Timer</a>* _tmr;           </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    std::list&lt;int&gt; _evtlist;    </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keyword">protected</span>:</div>
<div class="line"><a name="l00158"></a><span class="lineno"><a class="code" href="class_task.html#a28ec34b5b8eb76b4a76172f11b93af53">  158</a></span>&#160;    std::string <a class="code" href="class_task.html#a28ec34b5b8eb76b4a76172f11b93af53" title="Task name.">_name</a>;          </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;};</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="preprocessor">#endif </span><span class="comment">/* MMF_OS_TASK_TASK_H_ */</span><span class="preprocessor"></span></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 13 2015 13:55:41 for MMF by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
